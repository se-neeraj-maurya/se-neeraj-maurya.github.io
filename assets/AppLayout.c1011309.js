import{k as y,u as k,l as S,r as l,o as C,m as A,n as s,p as u,q as n,f as E,s as b,Q as x,t as B,P as N,E as $,v as I}from"./index.5dbc4d9f.js";import{u as L}from"./globalStore.8b2473a1.js";import{u as P}from"./adminStore.0570ef5d.js";import{u as Q}from"./cart-store.36ac37d2.js";import"./axios.boot.ea71beab.js";const R={key:0,class:"initial-loader"},T=n("div",{class:"loader"},null,-1),V=[T],q={key:1,class:"initial-loader"},O={class:"text-center"},j=n("p",null,"Something went wrong!",-1),K=Object.assign({name:"AppLayout"},{__name:"AppLayout",setup(G){const d=Q(),p=P(),m=y(),f=L(),r=k(),_=S(),t=l(!0),c=l(!1),i=!!localStorage.getItem("access-token"),a=JSON.parse(localStorage.getItem("user"));console.log({isAuthenticated:i,user:a}),i||r.replace({name:"login"});const h=async()=>{try{t.value=!0,await p.fetchConfig(),await f.fetchCategory(),await d.fetchCartItem(),v()}catch(e){console.log(e),c.value=!0}finally{t.value=!1}};["app","layout"].includes(_.name)&&r.replace({name:"home"});const g=()=>{window.location.reload(!0)},v=()=>{window.Pusher=N,window.Echo=new $({broadcaster:"pusher",key:"515f854c89b9657065f7",cluster:"ap2",forceTLS:!0}),console.log(`order-event-${a.role}`);var e=window.Echo.channel("order-notification");e.listen(`.order-event-${a.role}`,function(o){m.notify({progress:!0,type:"positive",position:"top",message:o.title,timeout:15e3})})};return C(()=>{h()}),(e,o)=>{const w=A("router-view");return t.value?(s(),u("div",R,V)):c.value?(s(),u("div",q,[n("div",O,[j,E(x,{outline:"",rounded:"",onClick:o[0]||(o[0]=J=>g())},{default:b(()=>[I(" Try Again! ")]),_:1})])])):(s(),B(w,{key:2}))}}});export{K as default};
