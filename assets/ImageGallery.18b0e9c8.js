import{av as M,r as u,c as K,w as k,o as Y,p as d,q as p,F as q,ah as U,am as E,f as l,t as r,Q as g,ac as F,al as Q,s as f,ai as H,aw as J,ax as L,v as h,ay as S,az as X,b3 as z,aB as Z,aC as W}from"./index.30e7e525.js";import{Q as ee}from"./QCardActions.8192f1d3.js";import{u as ae}from"./adminStore.72e89a93.js";const te=n=>(Z("data-v-ed7fec56"),n=n(),W(),n),le={key:0,class:"q-mb-md preview-section"},se={key:1,class:"upload-section"},oe={class:"full-width"},re=te(()=>f("div",{class:"upload-text q-pb-sm"},"Upload Images",-1)),ne={class:"row"},A="dmsfm3yci",ie="k4zgfot1",ce="982483478999539",ue="I0eChqGfHW5t6mr47HgxOqIouqs",de={__name:"ImageGallery",props:{multiple:{type:Boolean,default:!1},existingFile:{type:Array,default:()=>[]}},emits:["upload"],setup(n,{emit:w}){const y=n;ae();const x=u(!1),B=K(()=>y.multiple?5:1),o=u([]),I=u([]),_=u(!1),V=u(""),C=u(),P=u([]);k(()=>y.existingFile,t=>{o.value=t.map(a=>({url:a}))},{immediate:!0}),k(()=>o.value,()=>{T()},{deep:!0});const R=()=>{C.value.click()},D=async t=>{const a=t.target.files[0];try{_.value=!0;const e=await j(a);I.value.push(URL.createObjectURL(a)),o.value.push({file:a,url:e.data.secure_url,public_id:e.data.public_id,signature:e.data.signature})}catch(e){console.log(e)}finally{_.value=!1}t.target.value=null},G=async(t,a)=>{await O(t.public_id,t.signature),I.value.splice(a,1),o.value.splice(a,1)},N=(t,a,e)=>new Promise((s,b)=>{const m=new Image;m.src=URL.createObjectURL(t),m.onload=()=>{const v=document.createElement("canvas");let i=m.width,c=m.height;i>c?i>a&&(c*=a/i,i=a):c>e&&(i*=e/c,c=e),v.width=i,v.height=c,v.getContext("2d").drawImage(m,0,0,i,c),v.toBlob($=>{s($)},t.type)},m.onerror=v=>{b(v)}}),O=async(t,a)=>{try{return await z.post(`https://api.cloudinary.com/v1_1/${A}/:image/destroy`,{public_id:t,signature:a,api_key:ce,api_secret:ue})}catch(e){throw console.error("Error deleteing image:",e),e}},j=async t=>{if(!t){alert("Please select a file first.");return}_.value=!0;const a=await N(t,800,600),e=new FormData;e.append("file",a),e.append("upload_preset",ie);try{const s=await z.post(`https://api.cloudinary.com/v1_1/${A}/image/upload`,e);return V.value=s.data.secure_url,s}catch(s){throw console.error("Error uploading image:",s),s}finally{_.value=!1}},T=()=>{y.multiple?w("upload",o.value):w("upload",o.value[0])};return Y(()=>{}),(t,a)=>(d(),p("div",null,[o.value.length?(d(),p("div",le,[(d(!0),p(q,null,U(o.value,(e,s)=>(d(),p("div",{key:s,class:E(["preview-item",{multiple:n.multiple}])},[l(F,{src:e.url,ratio:1,"no-native-menu":"",class:"rounded-borders"},{default:r(()=>[l(g,{round:"",color:"red",icon:"close",size:"sm",class:"absolute all-pointer-events",style:{top:"4px",right:"4px"},onClick:b=>G(e,s)},null,8,["onClick"])]),_:2},1032,["src"])],2))),128))])):Q("",!0),o.value.length<B.value?(d(),p("div",se,[l(g,{onClick:R,outline:"",color:"primary",class:"upload-btn full-width",style:{height:"90px"},loading:_.value},{default:r(()=>[f("div",oe,[l(H,{name:"cloud_upload",size:"36px"})]),re]),_:1},8,["loading"]),f("input",{hidden:"",type:"file",ref_key:"uploader",ref:C,onChange:D},null,544)])):Q("",!0),l(X,{position:"bottom",modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=e=>x.value=e)},{default:r(()=>[l(J,{class:"dialog-radius-50"},{default:r(()=>[l(L,{class:"flex justify-center text-primary text-h5 q-px-xl q-py-lg"},{default:r(()=>[h(" Gallery ")]),_:1}),l(S),l(L,{style:{"max-height":"70vh"},class:"q-px-lg scroll"},{default:r(()=>[f("div",ne,[(d(!0),p(q,null,U(P.value,(e,s)=>(d(),p("div",{key:s,class:E(["col-4 q-pa-sm",{multiple:n.multiple}])},[l(F,{src:e.file_path,ratio:1,"no-native-menu":"",class:"rounded-borders"},null,8,["src"])],2))),128))])]),_:1}),l(S),l(ee,{class:"q-px-lg row"},{default:r(()=>[l(g,{outline:"",unelvated:"",rounded:"",class:"col"},{default:r(()=>[h(" Cancel ")]),_:1}),l(g,{color:"primary",unelevated:"",rounded:"",class:"col"},{default:r(()=>[h(" Select ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var ge=M(de,[["__scopeId","data-v-ed7fec56"]]);export{ge as I};
